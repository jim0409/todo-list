<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>test</title>

	<script>
		const scheme = "http://"
		const url = "192.168.2.110"
		const port = ":8000"
		const baseAddr = scheme + url + port
		let listContent = []


		function renderList(str, refresh) {
			if (refresh) {
				listContent = []
			}
			let htmlStr = ''

			JSON.parse(str, function (k, v) {
				if (k != "") {
					listContent.push({
						id: k,
						content: v
					})
				}
			})

			var dc = document.getElementById("list")
			listContent.forEach(function (item) {
				htmlStr = htmlStr + `
				<form>
					<p id=${item.id}>id: ${item.id}</p>
					<p>content: ${item.content}</p>
					<input id="update_${item.id}"">new content</input>
					<button type="submit" onclick="updateNote(${item.id})">update</button>
					<button type="submit" onclick="delNoteByID(${item.id})">delete</button>
				</form>
				`
			})
			dc.innerHTML = htmlStr
		}

		function updateNote(idObj) {
			const id = idObj.id
			const updateId = "#update_"+id
			const content = document.querySelector(updateId).value
			console.log(id)
			console.log(content)

			let addr = baseAddr + "/note/" + id
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("PUT", addr)
			xhttp.setRequestHeader("Content-Type", "application/json")
			xhttp.send(JSON.stringify({ "content": content }))
		}

		function delNoteByID(idObj) {
			const id = idObj.id
			console.log("test deleted...", id)
			let addr = baseAddr + "/note/" + id
			deleting(addr)
		}

		function getNotes() {
			let addr = baseAddr + "/notes"
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("GET", addr, true)
			xhttp.send()
		}

		function addNote() {
			const id = document.querySelector('#id').value
			const content = document.querySelector('#content').value;
			console.log(content)
			let addr = baseAddr + "/note/" + id
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("POST", addr)
			xhttp.setRequestHeader("Content-Type", "application/json")
			xhttp.send(JSON.stringify({ "content": content }))
		}

		function deleting(addr) {
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("DELETE", addr, true)
			xhttp.send()
		}

		function delNote() {
			const id = document.querySelector('#delid').value
			let addr = baseAddr + "/note/" + id
			deleting(addr)
		}


		window.onload = function () {
			getNotes()
		}

	</script>
</head>

<body>
	<div id="create-note">
		<h1>Create Note</h1>
		<form>
			<input type="text" id="id" placeholder="Enter Note ID">
			<input type="text" id="content" placeholder="Enter Note Content">
			<button type="submit" onclick="addNote()">Add Note</button>
		</form>
		<h1>Delete Note</h1>
		<form>
			<input type="text" id="delid" placeholder="Enter Delete Note ID">
			<button type="submit" onclick="delNote()">Delete Note</button>
		</form>
	</div>

	<button type="submit" id=updateBtn onclick="getNotes()">refresh</button>
	<div class="list" id="list">
		<div>
			<p>id: </p>
			<p>content: </p>
		</div>
	</div>
</body>

</html>