<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>test</title>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

	<script>
		const url = "192.168.2.110"
		const port = "8000"
		let listContent = []


		function renderList(str, refresh) {
			if (refresh) {
				listContent = []
			}
			let htmlStr = ''

			JSON.parse(str, function (k, v) {
				if (k != "") {
					listContent.push({
						id: k,
						content: v
					})
				}
			})

			var dc = document.getElementById("list")
			listContent.forEach(function (item) {
				htmlStr = htmlStr + `
				<div>
					<p>id: ${item.id}</p>
					<p>content: ${item.content}</p>
				</div>			
				`
			})

			dc.innerHTML = htmlStr
		}

		function getNotes() {
			const path = "/notes"
			const addr = "http://" + url + ":" + port + path
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("GET", addr, true)
			xhttp.send()
		}

		function addNote() {
			const id = document.querySelector('#id').value
			const content = document.querySelector('#content').value;
			console.log(content)
			const path = "/note/" + id
			const addr = "http://" + url + ":" + port + path
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("POST", addr )
			xhttp.setRequestHeader("Content-Type", "application/json")
			xhttp.send(JSON.stringify({ "content": content }))
		}

		function delNote() {
			const id = document.querySelector('#delid').value
			const path = "/note/" + id
			const addr = "http://" + url + ":" + port + path
			var xhttp = new XMLHttpRequest()
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					renderList(this.responseText, true)
				}
			};
			xhttp.open("DELETE", addr, true)
			xhttp.send()
		}


		window.onload = function () {
			getNotes()
		}

	</script>
</head>

<body>
	<div id="create-note">
		<h1>Create Note</h1>
		<form>
			<input type="text" id="id" placeholder="Enter Note ID">
			<input type="text" id="content" placeholder="Enter Note Content">
			<button type="submit" onclick="addNote()">Add Note</button>
		</form>
		<h1>Delete Note</h1>
		<form>
			<input type="text" id="delid" placeholder="Enter Delete Note ID">
			<button type="submit" onclick="delNote()">Delete Note</button>
		</form>
	</div>

	<button type="submit" id=updateBtn onclick="getNotes()">refresh</button>
	<div class="list" id="list">
		<div>
			<p>id: </p>
			<p>content: </p>
		</div>
	</div>
</body>

</html>